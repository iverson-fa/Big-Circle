# Harware

## 1 MAC & PHY

在以太网系统中，**MAC（Media Access Control）** 和 **PHY（Physical Layer Device）** 是两个关键组成部分，它们在以太网通信中各司其职、协同工作。下面是它们的定义、功能以及之间的关系说明：

---

### 1.1 MAC（Media Access Control）

**MAC 是以太网协议栈中的“数据链路层”的子层**，主要职责包括：

#### 功能：

* **帧封装与解封装**：将 IP 层数据打包成以太网帧，或将收到的帧解包给上层。
* **地址处理**：处理以太网帧的目的和源 MAC 地址。
* **控制访问**：管理介质访问（如全双工/半双工控制、冲突检测等）。
* **与 PHY 通信**：通过标准接口（如 MII、GMII、RGMII、XFI、USXGMII）与 PHY 通信。

#### 位置：

* MAC 通常是 **SoC（如 Jetson AGX Orin）内部的硬件模块**，比如 NVIDIA 的 EQOS 或 MGBE 控制器。

---

### 1.2 PHY（Physical Layer Device）

**PHY 是以太网“物理层”的实现组件**，主要职责包括：

#### 功能：

* **模拟与数字信号转换**：将 MAC 发来的数字信号转换为线路上的模拟电信号，反之亦然。
* **速率协商（Auto-Negotiation）**：确定通信速率（10M/100M/1G/2.5G/5G/10G）。
* **电气接口管理**：如 SGMII、XFI、RGMII、USXGMII、1000BASE-T、10GBASE-R 等。
* **链路检测与时钟恢复**。

#### 位置：

* PHY 通常是 **外部芯片**（如 Marvel、TI、Realtek 等生产的 PHY 芯片），通过 **SERDES、RGMII、XFI 等接口**与 MAC 相连。

---

### 1.3 MAC 与 PHY 的连接方式

#### 常见连接接口：

| 接口类型           | 描述                         | 支持速率       |
| -------------- | -------------------------- | ---------- |
| MII / RMII     | 用于低速 PHY 接口                | 10M / 100M |
| GMII / RGMII   | 常见千兆以太网接口                  | 1G         |
| SGMII / QSGMII | 串行连接                       | 1G、4x1G    |
| XFI            | 高速串行接口                     | 10G        |
| USXGMII        | 多速率接口（灵活支持 10G/5G/2.5G/1G） | 多速率        |
| SerDes         | 高速串行器/解串器接口                | 多速率        |

#### 控制通道：

* 使用 **MDIO/MDC** 作为管理通道，用于 MAC 控制器配置和查询 PHY 寄存器（比如获取 PHY ID、设置速度/模式等）。

---

### 1.4 工作流程示意图（逻辑关系）

```
       [应用层 / 网络协议栈]
                 ↓
         [MAC 控制器（SoC 内部）]
                 ↓
         （XFI / RGMII / USXGMII）
                 ↓
           [PHY 芯片（外部）]
                 ↓
         （电缆：双绞线 / 光纤等）
                 ↓
            [远端以太网设备]
```

---

### 1.5 总结

| 项目   | MAC                        | PHY                 |
| ---- | -------------------------- | ------------------- |
| 所属层  | 数据链路层                      | 物理层                 |
| 功能   | 帧处理、地址解析、链路控制              | 电信号处理、速率协商、物理传输     |
| 实现位置 | SoC 内部硬件模块                 | 外部芯片                |
| 典型接口 | RGMII, SGMII, XFI, USXGMII | 与电缆连接               |
| 管理方式 | 控制 PHY                     | 被 MAC 控制，通过 MDIO 接口 |

---