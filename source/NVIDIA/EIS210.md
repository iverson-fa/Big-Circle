# EIS210 修改项

## 1 在容器中使用chroot修改根文件目录

```bash
docker container create --name eis200 --hostname docker -v /home/dafa/jetson_flash/r35.3:/root -it ubuntu:20.04 /bin/bash
```

## 2 项目定制

### 2.1 修改开机 LOGO

使用 [edk2](https://big-circle.readthedocs.io/en/latest/NVIDIA/Bug.html#edk2uefi) 生成UEFI，注意`bmp`图片位色会影响最后 uefi_Jetson_RELEASE.bin 的大小，经测试，**16位**的图片生成的大小是2.7M，可以正常使用。

## 3 usb0 的使用

- `hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02-fixed-regulator.dtsi `
- `hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02.dtsi`

第一个文件上电，第二个文件将usb0的role改为host，可以刷机后在OS里验证：

```bash 
cat /sys/devices/platform/3520000.xusb_padctl/usb2-0/usb_role/usb2-0-role-switch/role
```

```shell
diff --git a/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02-fixed-regulator.dtsi b/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02-fixed-regulator.dtsi
index 07ba1b0d8..3724fb0e3 100644
--- a/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02-fixed-regulator.dtsi
+++ b/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02-fixed-regulator.dtsi
@@ -11,7 +11,7 @@
  * FITNESS FOR A PARTICULAR PURPOSE.  See the GNU General Public License for
  * more details.
  */
-
+#include <dt-bindings/gpio/tegra234-gpio.h>
 / {
 	fixed-regulators {
 		p3509_vdd_5v_sys: regulator@100 {
@@ -101,5 +101,14 @@
 			vin-supply = <&p3509_vdd_3v3_sys>;
 			regulator-always-on;
 		};
+		p3509_vdd_usb1_5v: regulator@109 {
+			compatible = "regulator-fixed";
+			reg = <109>;
+			regulator-name = "vdd-usb1-5v";
+			regulator-min-microvolt = <5000000>;
+			regulator-max-microvolt = <5000000>;
+			gpio = <&tegra_main_gpio TEGRA234_MAIN_GPIO(Z, 1) 0>;
+			regulator-always-on;
+		};
 	};
 };
diff --git a/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02.dtsi b/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02.dtsi
index b6f1047d2..19aa8e899 100644
--- a/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02.dtsi
+++ b/hardware/nvidia/platform/t23x/p3768/kernel-dts/cvb/tegra234-p3509-a02.dtsi
@@ -11,6 +11,7 @@
  * more details.
  */
 #include <dt-bindings/gpio/tegra234-gpio.h>
+#include <dt-bindings/usb/role.h>
 #include "dt-bindings/input/input.h"
 #include "tegra234-p3509-a02-pwm-fan.dtsi"
 #include "tegra234-p3509-a02-pcie.dtsi"
@@ -98,7 +99,7 @@
 					compatible = "usb-b-connector", "gpio-usb-b-connector";
  					label = "micro-USB";
  					type = "micro";
- 					vbus-gpio = <&tegra_main_gpio TEGRA234_MAIN_GPIO(Z, 1) GPIO_ACTIVE_LOW>;
+					cable-connected-on-boot = <USB_ROLE_HOST>;
  				};
 #endif
 			};
```

其他模组的NVBUG： 3299244(for TX2NX)/2994982(for Xavier NX)/2926573(for Jetson Nano)
