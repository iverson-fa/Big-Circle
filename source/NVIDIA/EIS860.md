# EIS860 修改项

基于 JP 5.1（L4T 35.2.1）整理。以下 patch 文件均在 BSP 解压目录 `Linux_for_Tegra` 中生成。

## 1. 关闭 EEPROM

- `Linux_for_Tegra/bootloader/tegra234-mb2-bct-common.dtsi`

```bash
---
 bootloader/tegra234-mb2-bct-common.dtsi | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/bootloader/tegra234-mb2-bct-common.dtsi b/bootloader/tegra234-mb2-bct-common.dtsi
index f5e358ebd..b778b8da0 100644
--- a/bootloader/tegra234-mb2-bct-common.dtsi
+++ b/bootloader/tegra234-mb2-bct-common.dtsi
@@ -37,7 +37,7 @@
             cvm_eeprom_read_size = <0x100>;
             cvb_eeprom_i2c_instance = <0x0>;
             cvb_eeprom_i2c_slave_address = <0xac>;
-            cvb_eeprom_read_size = <0x100>;
+            cvb_eeprom_read_size = <0>;
         };
 
         clocks {
-- 
```

## 2. UPHY 配置

- `Linux_for_Tegra/p3701.conf.common`

```shell
---
 p3701.conf.common | 2 +-
 1 file changed, 1 insertion(+), 1 deletion(-)

diff --git a/p3701.conf.common b/p3701.conf.common
index 50ea17751..4b74e9191 100644
--- a/p3701.conf.common
+++ b/p3701.conf.common
@@ -162,7 +162,7 @@ process_fuse_level()
 
 # Common values and/or defaults across P3701:
 
-ODMDATA="gbe-uphy-config-22,hsstp-lane-map-3,nvhs-uphy-config-0,hsio-uphy-config-0,gbe0-enable-10g";
+ODMDATA="gbe-uphy-config-0,hsstp-lane-map-3,hsio-uphy-config-16,nvhs-uphy-config-0";
 CHIPID=0x23;
 ITS_FILE=;
 OVERLAY_DTB_FILE="L4TConfiguration.dtbo,tegra234-p3737-audio-codec-rt5658-40pin.dtbo,tegra234-p3737-overlay.dtbo,tegra234-p3701-overlay.dtbo";
-- 
```

## 3 PCIE 配置

- `Linux_for_Tegra/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-ethernet-3737-0000.dtsi`

- `Linux_for_Tegra/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-p3737-pcie.dtsi`

```shell
---
 .../tegra234-mb1-bct-gpio-p3701-0000-a04.dtsi    |  5 +++--
 .../cvb/tegra234-ethernet-3737-0000.dtsi         |  2 +-
 .../kernel-dts/cvb/tegra234-p3737-pcie.dtsi      | 16 ++++++++++++++++
 3 files changed, 20 insertions(+), 3 deletions(-)

diff --git a/bootloader/tegra234-mb1-bct-gpio-p3701-0000-a04.dtsi b/bootloader/tegra234-mb1-bct-gpio-p3701-0000-a04.dtsi
index ed4dc089b..dcc52d12b 100644
--- a/bootloader/tegra234-mb1-bct-gpio-p3701-0000-a04.dtsi
+++ b/bootloader/tegra234-mb1-bct-gpio-p3701-0000-a04.dtsi
@@ -60,6 +60,7 @@
 				TEGRA234_MAIN_GPIO(G, 0)
 				TEGRA234_MAIN_GPIO(G, 1)
 				TEGRA234_MAIN_GPIO(G, 2)
+				TEGRA234_MAIN_GPIO(G, 4)
 				TEGRA234_MAIN_GPIO(G, 7)
 				TEGRA234_MAIN_GPIO(H, 0)
 				TEGRA234_MAIN_GPIO(H, 7)
@@ -75,8 +76,8 @@
 				TEGRA234_MAIN_GPIO(K, 7)
 				TEGRA234_MAIN_GPIO(L, 2)
 				TEGRA234_MAIN_GPIO(L, 3)
-				TEGRA234_MAIN_GPIO(AG, 0)
-				TEGRA234_MAIN_GPIO(AG, 1)
+				/*TEGRA234_MAIN_GPIO(AG, 0)
+				TEGRA234_MAIN_GPIO(AG, 1)*/
 				TEGRA234_MAIN_GPIO(AG, 2)
 				TEGRA234_MAIN_GPIO(AG, 3)
 				TEGRA234_MAIN_GPIO(AG, 6)
diff --git a/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-ethernet-3737-0000.dtsi b/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-ethernet-3737-0000.dtsi
index 50a768c55..d76554738 100644
--- a/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-ethernet-3737-0000.dtsi
+++ b/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-ethernet-3737-0000.dtsi
@@ -19,7 +19,7 @@
 / {
 	/* MGBE - A */
 	ethernet@6810000 {
-		status = "okay";
+		status = "disabled";
 		nvidia,mac-addr-idx = <0>;
 		nvidia,max-platform-mtu = <16383>;
 		/* 0=enable, 1=disable */
diff --git a/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-p3737-pcie.dtsi b/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-p3737-pcie.dtsi
index efb9371ed..43b074b62 100644
--- a/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-p3737-pcie.dtsi
+++ b/source/public/hardware/nvidia/platform/t23x/concord/kernel-dts/cvb/tegra234-p3737-pcie.dtsi
@@ -56,4 +56,20 @@
 		phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3", "p2u-4",
 			    "p2u-5", "p2u-6", "p2u-7";
 	};
+
+    pcie@14180000 {
+    status = "okay";
+    phys = <&p2u_hsio_0>;
+    phy-names = "p2u-0";
+    };
+
+    pcie@141e0000 {
+          status = "okay";
+          num-lanes = <8>;
+          phys = <&p2u_gbe_0>, <&p2u_gbe_1>, <&p2u_gbe_2>,
+                    <&p2u_gbe_3>, <&p2u_gbe_4>, <&p2u_gbe_5>,
+                    <&p2u_gbe_6>, <&p2u_gbe_7>;
+          phy-names = "p2u-0", "p2u-1", "p2u-2", "p2u-3",
+                      "p2u-4", "p2u-5", "p2u-6", "p2u-7";
+    };
 };
-- 
```



## 4 启用HDMI



## 5 Pinmux配置



## 6 nvpmodel 配置



## 7 ucsi_ccg 报错



## 8 网口丝印与系统下连接网口名一致



## 9 集成MCU



## 10 USB 配置

### 10.1 USB 3.0

```bash
# rc.local
echo 'host' >/sys/devices/platform/3520000.xusb_padctl/usb2-0/usb_role/usb2-0-role-switch/role
```

### 10.2  USB 2.0 单独插键盘不能用

```bash
# /boot/extlinux 追加
usbcore.autosuspend=-1
```

## 11 定制软件安装

以定制 NTP 为例

```bash
# 在 EIS860 中下载ntp
apt-get download sntp
# copy到host执行
dpkg-deb -R  ntp***.deb software
# 将software目录copy到rootfs
```

## 12 BUG



## 13 其他

### 13.1 IECP

IECP运行需要执行命令`cpufreq-info`和`dmidecode`，需要安装以下两个包：

- cpufrequtils
- dmidecode

需要在host制作刷机包时加入EIS860版本信息：

```bash
# etc/os-release 添加
EIS860_VERSION="2.1"
```

