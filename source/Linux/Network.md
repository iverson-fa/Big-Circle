# Network

## 1 ç½‘ç»œåˆ†äº«

B -> A -> www

```shell
# on A
export eth_share=eth1
export eth_net=eth0
ifconfig $eth_share 192.168.3.1/24
bash -c 'echo 1 > /proc/sys/net/ipv4/ip_forward'
iptables -F
iptables -P INPUT ACCEPT
iptables -P FORWARD ACCEPT
iptables -t nat -A POSTROUTING -o $eth_net -j MASQUERADE
```
```shell
# on B
eth_www=eth2
ifconfig $eth_www 192.168.3.2/24
route add -net 0.0.0.0/0 gw 192.168.3.1
chmod +666 /etc/resolv.conf
echo "nameserver 114.114.114.114" > /etc/resolv.conf
```

## 2 åŒç½‘å¡å†²çª

```shell
# route -n
Kernel IP routing table
Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
0.0.0.0         192.168.3.1     0.0.0.0         UG    0      0        0 eth0
0.0.0.0         10.126.59.254   0.0.0.0         UG    0      0        0 wlan0
```

æ˜¾ç¤º `eth0` å’Œ `wlan0` éƒ½æœ‰é»˜è®¤ç½‘å…³ (`0.0.0.0`)ï¼Œå¯èƒ½å¯¼è‡´è·¯ç”±å†²çªæˆ–ç½‘ç»œé—®é¢˜ã€‚

### **åˆ†æ**
- **`eth0` é»˜è®¤ç½‘å…³ï¼š`192.168.3.1`**
- **`wlan0` é»˜è®¤ç½‘å…³ï¼š`10.126.59.254`**
- ç”±äº `0.0.0.0` åªèƒ½æœ‰ä¸€ä¸ªé»˜è®¤è·¯ç”±ï¼Œç³»ç»Ÿå¯èƒ½ä¼šéšæœºé€‰æ‹©å…¶ä¸­ä¸€ä¸ªï¼Œæˆ–è€…æŒ‰ä¼˜å…ˆçº§å†³å®šã€‚

### **å¯èƒ½çš„å½±å“**
1. **ç½‘ç»œè¿æ¥ä¸ç¨³å®š**
   - ç³»ç»Ÿå¯èƒ½ä¼šéšæœºä½¿ç”¨ `eth0` æˆ– `wlan0` å‡ºç½‘ï¼Œå¯¼è‡´ç½‘ç»œè¿æ¥æ—¶æ–­æ—¶ç»­ã€‚

2. **æŸäº›ç½‘ç»œè®¿é—®å¤±è´¥**
   - å¯èƒ½æœ‰çš„æµé‡ä» `eth0` èµ°ï¼Œæœ‰çš„ä» `wlan0` èµ°ï¼Œå¯¼è‡´éƒ¨åˆ†è®¿é—®å¤±è´¥ã€‚

---

### **è§£å†³æ–¹æ¡ˆ**
#### **æ–¹æ³• 1ï¼šæ‰‹åŠ¨åˆ é™¤ä¸€ä¸ªé»˜è®¤è·¯ç”±**
å¦‚æœå¸Œæœ› **`eth0` ä½œä¸ºé»˜è®¤è·¯ç”±**ï¼Œåˆ é™¤ `wlan0` çš„é»˜è®¤è·¯ç”±ï¼š
```bash
sudo route del default gw 10.126.59.254 wlan0
```
å¦‚æœå¸Œæœ› **`wlan0` ä½œä¸ºé»˜è®¤è·¯ç”±**ï¼Œåˆ é™¤ `eth0` çš„é»˜è®¤è·¯ç”±ï¼š
```bash
sudo route del default gw 192.168.3.1 eth0
```
ä½†è¿™æ ·åš **é‡å¯åä¼šæ¢å¤**ï¼Œéœ€è¦åœ¨ `/etc/network/interfaces` æˆ– `systemd-networkd` é‡Œä¿®æ”¹ã€‚

---

#### **æ–¹æ³• 2ï¼šä½¿ç”¨ `metric` è®¾å®šä¼˜å…ˆçº§**
å¯ä»¥è®© `eth0` çš„ `metric` æ›´å°ï¼Œä¼˜å…ˆä½¿ç”¨æœ‰çº¿ï¼š
```bash
sudo ip route change default via 192.168.3.1 dev eth0 metric 100
sudo ip route change default via 10.126.59.254 dev wlan0 metric 200
```
æˆ–è€…åè¿‡æ¥ï¼Œè®© `wlan0` ä¼˜å…ˆï¼š
```bash
sudo ip route change default via 10.126.59.254 dev wlan0 metric 100
sudo ip route change default via 192.168.3.1 dev eth0 metric 200
```
è¿™æ ·ï¼Œç³»ç»Ÿä¼š **ä¼˜å…ˆé€‰æ‹© `metric` å°çš„è·¯ç”±**ã€‚

---

#### **æ–¹æ³• 3ï¼šä½¿ç”¨ `ip rule` å’Œ `ip route` åˆ†æµ**
å¦‚æœä½ å¸Œæœ›ï¼š
- **192.168.3.x èµ° `eth0`**
- **å…¶ä»–æµé‡èµ° `wlan0`**

å¯ä»¥è¿™æ ·è®¾ç½®ï¼š
```bash
# ç»™ wlan0 åˆ›å»ºä¸€ä¸ªè·¯ç”±è¡¨ 100
sudo ip rule add from 10.126.59.0/24 table 100
sudo ip route add default via 10.126.59.254 dev wlan0 table 100
```
è¿™æ · `eth0` ä¸»è¦è´Ÿè´£ `192.168.3.x`ï¼Œè€Œ `wlan0` è´Ÿè´£å…¶ä»–æµé‡ã€‚

---

#### **æ–¹æ³• 4ï¼šåœ¨ `/etc/network/interfaces` é…ç½®**
å¦‚æœä½ æƒ³ **æ°¸ä¹…ä¿®æ”¹é»˜è®¤ç½‘å…³**ï¼Œå¯ä»¥åœ¨ `/etc/network/interfaces` é‡Œè®¾ç½®ï¼š
```ini
auto eth0
iface eth0 inet static
    address 192.168.3.2
    netmask 255.255.255.0
    gateway 192.168.3.1
    metric 100

auto wlan0
iface wlan0 inet dhcp
    metric 200
```
ç„¶åé‡å¯ç½‘ç»œï¼š
```bash
sudo systemctl restart networking
```
æˆ–è€…ï¼š
```bash
sudo ifdown eth0 && sudo ifup eth0
```

---

### **æ€»ç»“**
- **å¦‚æœåªæƒ³ç”¨ `eth0` ä¸Šç½‘** ğŸ‘‰ åˆ é™¤ `wlan0` é»˜è®¤ç½‘å…³
- **å¦‚æœåªæƒ³ç”¨ `wlan0` ä¸Šç½‘** ğŸ‘‰ åˆ é™¤ `eth0` é»˜è®¤ç½‘å…³
- **å¦‚æœå¸Œæœ› `eth0` ä¼˜å…ˆ** ğŸ‘‰ è®¾ç½® `metric`
- **å¦‚æœæƒ³æŒ‰ IP æ®µåˆ†æµ** ğŸ‘‰ ä½¿ç”¨ `ip rule` + `ip route`
- **å¦‚æœè¦æ°¸ä¹…ç”Ÿæ•ˆ** ğŸ‘‰ ä¿®æ”¹ `/etc/network/interfaces`

## 3 ip route å’Œ ip rule

`ip rule` å’Œ `ip route` æ˜¯ Linux ä¸­ç”¨äºç½‘ç»œè·¯ç”±ç®¡ç†çš„é‡è¦å·¥å…·ï¼Œå®ƒä»¬æä¾›äº†å¯¹è·¯ç”±è§„åˆ™å’Œè·¯ç”±è¡¨çš„ç»†è‡´æ§åˆ¶ã€‚ä»¥ä¸‹æ˜¯è¿™äº›å‘½ä»¤çš„æ¦‚è¿°å’Œå¸¸è§ç”¨æ³•ï¼š

### **`ip rule`**ï¼ˆç”¨äºç®¡ç†ç­–ç•¥è·¯ç”±ï¼‰

`ip rule` ç”¨äºåˆ›å»ºã€åˆ é™¤æˆ–æŸ¥çœ‹è·¯ç”±è§„åˆ™ã€‚è¿™äº›è§„åˆ™å†³å®šäº†å¦‚ä½•æ ¹æ®æºåœ°å€ã€ç›®æ ‡åœ°å€ã€æ¥å£ç­‰æ¡ä»¶é€‰æ‹©è·¯ç”±è¡¨ã€‚å¯ä»¥é€šè¿‡ `ip rule` é…ç½®æ›´å¤æ‚çš„è·¯ç”±ç­–ç•¥ã€‚

#### **å¸¸ç”¨å‘½ä»¤ï¼š**

1. **æŸ¥çœ‹å½“å‰ç­–ç•¥è·¯ç”±è§„åˆ™ï¼š**
   ```bash
   ip rule show
   ```
   æ˜¾ç¤ºå½“å‰æ‰€æœ‰çš„è·¯ç”±è§„åˆ™ã€‚

2. **æ·»åŠ æ–°çš„ç­–ç•¥è·¯ç”±è§„åˆ™ï¼š**
   ```bash
   ip rule add from <source_ip> table <table_id> [other_conditions]
   ```
   æ·»åŠ ä¸€ä¸ªåŸºäºæºåœ°å€çš„è§„åˆ™ï¼Œä¾‹å¦‚ï¼š
   ```bash
   ip rule add from 192.168.1.0/24 table 100
   ```
   è¿™ä¸ªè§„åˆ™è¡¨ç¤ºï¼šæ‰€æœ‰æºåœ°å€ä¸º `192.168.1.0/24` çš„æµé‡éƒ½ä¼šæŸ¥æ‰¾è·¯ç”±è¡¨ `100`ã€‚

3. **åˆ é™¤ç­–ç•¥è·¯ç”±è§„åˆ™ï¼š**
   ```bash
   ip rule del from <source_ip> table <table_id> [other_conditions]
   ```
   åˆ é™¤æŒ‡å®šçš„è·¯ç”±è§„åˆ™ï¼Œä¾‹å¦‚ï¼š
   ```bash
   ip rule del from 192.168.1.0/24 table 100
   ```

4. **æ·»åŠ åŸºäºç›®æ ‡åœ°å€çš„è§„åˆ™ï¼š**
   ```bash
   ip rule add to <destination_ip> table <table_id>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip rule add to 10.0.0.0/8 table 200
   ```
   è¿™æ¡è§„åˆ™è¡¨ç¤ºï¼šæ‰€æœ‰ç›®æ ‡ä¸º `10.0.0.0/8` çš„æµé‡ä¼šæŸ¥æ‰¾è·¯ç”±è¡¨ `200`ã€‚

5. **æ·»åŠ è§„åˆ™æŒ‡å®šæ¥å£ï¼š**
   ```bash
   ip rule add iif <interface> table <table_id>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip rule add iif eth0 table 300
   ```
   è¿™æ¡è§„åˆ™è¡¨ç¤ºï¼šæ¥è‡ªæ¥å£ `eth0` çš„æµé‡ä¼šæŸ¥æ‰¾è·¯ç”±è¡¨ `300`ã€‚

6. **è®¾ç½®è§„åˆ™ä¼˜å…ˆçº§ï¼š**
   å¯ä»¥ä½¿ç”¨ `priority` æ¥è®¾ç½®è§„åˆ™çš„ä¼˜å…ˆçº§ï¼š
   ```bash
   ip rule add from <source_ip> table <table_id> priority <priority_number>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip rule add from 192.168.1.0/24 table 100 priority 100
   ```

### **`ip route`**ï¼ˆç”¨äºç®¡ç†è·¯ç”±è¡¨ï¼‰

`ip route` ç”¨äºæ˜¾ç¤ºã€æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è·¯ç”±è¡¨ä¸­çš„æ¡ç›®ã€‚å®ƒæ”¯æŒå¤šè·¯ç”±è¡¨ã€ç­–ç•¥è·¯ç”±ã€é»˜è®¤ç½‘å…³è®¾ç½®ç­‰ã€‚

#### **å¸¸ç”¨å‘½ä»¤ï¼š**

1. **æŸ¥çœ‹è·¯ç”±è¡¨ï¼š**
   ```bash
   ip route show
   ```
   æˆ–è€…ç®€å†™ï¼š
   ```bash
   ip r
   ```
   æ˜¾ç¤ºæ‰€æœ‰è·¯ç”±è¡¨æ¡ç›®ï¼ŒåŒ…æ‹¬é»˜è®¤ç½‘å…³ã€è·¯ç”±è¡¨å’Œæ¥å£ã€‚

2. **æ·»åŠ é»˜è®¤è·¯ç”±ï¼š**
   ```bash
   ip route add default via <gateway_ip> dev <interface> metric <metric_value>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route add default via 10.16.10.1 dev eth0 metric 100
   ```
   è¿™è¡¨ç¤ºé€šè¿‡ `eth0` æ¥å£å°†æµé‡å‘é€åˆ° `10.16.10.1` ç½‘å…³ï¼Œ`metric` ç”¨äºè®¾ç½®è·¯ç”±ä¼˜å…ˆçº§ã€‚

3. **æ·»åŠ å…·ä½“è·¯ç”±ï¼š**
   ```bash
   ip route add <destination_network> via <gateway_ip> dev <interface> metric <metric_value>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route add 10.0.0.0/8 via 10.16.10.1 dev eth0 metric 100
   ```
   è¿™æ¡å‘½ä»¤æ·»åŠ äº†ä¸€æ¡è·¯ç”±ï¼Œä½¿å¾— `10.0.0.0/8` çš„æµé‡é€šè¿‡ `10.16.10.1` ç½‘å…³ï¼Œå¹¶ä½¿ç”¨ `eth0` æ¥å£ã€‚

4. **åˆ é™¤è·¯ç”±ï¼š**
   ```bash
   ip route del <destination_network> via <gateway_ip> dev <interface>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route del 10.0.0.0/8 via 10.16.10.1 dev eth0
   ```

5. **æ·»åŠ è·¯ç”±åˆ°ç‰¹å®šè·¯ç”±è¡¨ï¼š**
   å¦‚æœä½ ä½¿ç”¨å¤šä¸ªè·¯ç”±è¡¨ï¼Œå¯ä»¥æŒ‡å®šæŸä¸ªè·¯ç”±è¡¨ï¼š
   ```bash
   ip route add <destination_network> via <gateway_ip> dev <interface> table <table_id>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route add 10.0.0.0/8 via 10.16.10.1 dev eth0 table 100
   ```

6. **è®¾ç½®è·¯ç”±ä¼˜å…ˆçº§ï¼ˆé€šè¿‡ metricï¼‰ï¼š**
   ä½¿ç”¨ `metric` è®¾ç½®ä¼˜å…ˆçº§ï¼Œå€¼è¶Šå°ä¼˜å…ˆçº§è¶Šé«˜ã€‚ä¾‹å¦‚ï¼š
   ```bash
   ip route add 10.0.0.0/8 via 10.16.10.1 dev eth0 metric 50
   ```

7. **æŸ¥çœ‹æŒ‡å®šè·¯ç”±è¡¨ï¼š**
   å¦‚æœä½ åœ¨ä½¿ç”¨å¤šä¸ªè·¯ç”±è¡¨ï¼Œå¯ä»¥æŸ¥çœ‹æŒ‡å®šçš„è·¯ç”±è¡¨ï¼š
   ```bash
   ip route show table <table_id>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route show table 100
   ```

8. **æ¸…ç©ºè·¯ç”±è¡¨ï¼š**
   åˆ é™¤æ‰€æœ‰è·¯ç”±æ¡ç›®ï¼š
   ```bash
   ip route flush table <table_id>
   ```
   ä¾‹å¦‚ï¼š
   ```bash
   ip route flush table 100
   ```

### **`ip rule` å’Œ `ip route` é…åˆä½¿ç”¨**

`ip rule` å’Œ `ip route` å¯ä»¥ç»“åˆä½¿ç”¨æ¥å®ç°ç­–ç•¥è·¯ç”±ã€‚æ¯”å¦‚ï¼Œä½ å¯ä»¥ä½¿ç”¨ `ip rule` è®¾ç½®åŸºäºæºåœ°å€ã€ç›®æ ‡åœ°å€æˆ–æ¥å£çš„è·¯ç”±è§„åˆ™ï¼Œç„¶åä½¿ç”¨ `ip route` æ¥ç®¡ç†ç›¸åº”çš„è·¯ç”±è¡¨ã€‚

#### **ç¤ºä¾‹ï¼š**
1. åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±è¡¨ï¼ˆä¾‹å¦‚ `100`ï¼‰å¹¶æ·»åŠ è·¯ç”±ï¼š
   ```bash
   ip route add 192.168.1.0/24 via 10.16.10.1 dev eth1 table 100
   ```

2. åˆ›å»ºä¸€æ¡è§„åˆ™ï¼ŒæŒ‡å®šæ‰€æœ‰æ¥è‡ª `192.168.1.0/24` çš„æµé‡ä½¿ç”¨ `table 100`ï¼š
   ```bash
   ip rule add from 192.168.1.0/24 table 100
   ```

3. æŸ¥çœ‹è·¯ç”±è§„åˆ™å’Œè·¯ç”±è¡¨ï¼š
   ```bash
   ip rule show
   ip route show table 100
   ```
4. ä¸¾ä¾‹

å¦‚æœ eth1 éœ€è¦å•ç‹¬å¤„ç†æŸäº›æµé‡ï¼ˆæ¯”å¦‚ç‰¹å®šæœåŠ¡ï¼‰ï¼Œå¯ä»¥ä¸ºå®ƒè®¾ç½®ä¸“ç”¨çš„ ip ruleï¼š
```bash
# 10.16.10.101 æ˜¯ eth1 çš„ IPï¼Œè¯·æ›¿æ¢ä¸ºå®é™… IP
sudo ip rule add from 10.16.10.101 lookup 200
sudo ip route add default via 10.16.10.1 dev eth1 table 200
```
---

### **æ€»ç»“ï¼š**

- **`ip rule`** ç”¨äºç®¡ç†**ç­–ç•¥è·¯ç”±**ï¼Œæ ¹æ®æºåœ°å€ã€ç›®æ ‡åœ°å€ã€æ¥å£ç­‰æ¡ä»¶é€‰æ‹©è·¯ç”±è¡¨ã€‚
- **`ip route`** ç”¨äºç®¡ç†**è·¯ç”±è¡¨**ï¼ŒåŒ…æ‹¬æ·»åŠ ã€åˆ é™¤å’Œä¿®æ”¹è·¯ç”±æ¡ç›®ï¼Œå¯ä»¥å®ç°æ›´å…·ä½“çš„æµé‡æ§åˆ¶ã€‚
- é€šè¿‡å°†è¿™ä¸¤ä¸ªå·¥å…·ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥å®ç°å¤æ‚çš„è·¯ç”±ç­–ç•¥ï¼Œå¦‚åŸºäºä¸åŒæ¡ä»¶é€‰æ‹©ä¸åŒè·¯ç”±è¡¨ï¼Œæˆ–æ ¹æ®ä¼˜å…ˆçº§å®ç°æµé‡çš„åŠ¨æ€è·¯ç”±ã€‚

è¿™ä¸¤ä¸ªå·¥å…·ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æä¾›éå¸¸å¼ºå¤§çš„çµæ´»æ€§ï¼Œå°¤å…¶æ˜¯åœ¨å¤šç½‘å¡ã€å¤æ‚ç½‘ç»œæ‹“æ‰‘å’Œç­–ç•¥è·¯ç”±çš„ç¯å¢ƒä¸­ã€‚

## 4 åŒä¸€ç½‘æ®µåŒç½‘å¡é¿å…å›ç¨‹æµé‡ä¸ä¸€è‡´

### **ç›®æ ‡**
- **`eth0`ï¼ˆ10.16.10.17/24ï¼‰** è´Ÿè´£ä¸Šç½‘ï¼Œé»˜è®¤è·¯ç”±é€šè¿‡ `eth0` å‘é€å¤–éƒ¨æµé‡ã€‚
- **`eth1`ï¼ˆ10.16.10.152/24ï¼‰** è´Ÿè´£å±€åŸŸç½‘ `10.16.10.0/24` çš„æµé‡ï¼Œåªç”¨äºå†…éƒ¨é€šä¿¡ã€‚

---

### **é…ç½®æ­¥éª¤**
#### **1. åˆ é™¤å¯èƒ½çš„é»˜è®¤å†²çªè·¯ç”±**
é¦–å…ˆæ£€æŸ¥æ˜¯å¦å·²ç»æœ‰ `eth1` å½±å“ `10.16.10.0/24` çš„æµé‡ï¼š
```bash
ip route show
```
å¦‚æœ `eth1` ä¹Ÿæœ‰ `10.16.10.0/24` çš„é»˜è®¤è·¯ç”±ï¼Œéœ€è¦åˆ é™¤ï¼š
```bash
sudo ip route del 10.16.10.0/24 dev eth0
```

---

#### **2. è®¾ç½®é»˜è®¤è·¯ç”±èµ° `eth0`ï¼ˆç”¨äºä¸Šç½‘ï¼‰**
```bash
sudo ip route add default via 10.16.10.1 dev eth0 metric 100
```
è¿™é‡Œï¼š
- `10.16.10.1` æ˜¯é»˜è®¤ç½‘å…³ï¼ˆè¯·ç¡®è®¤ä½ çš„ç½‘å…³åœ°å€æ˜¯å¦æ­£ç¡®ï¼‰ã€‚
- `metric 100` ç¡®ä¿ `eth0` çš„é»˜è®¤è·¯ç”±ä¼˜å…ˆçº§é«˜äºå…¶ä»–å¯èƒ½çš„è·¯ç”±ã€‚

---

#### **3. è®¾ç½® `10.16.10.0/24` æµé‡èµ° `eth1`**
```bash
sudo ip route add 10.16.10.0/24 dev eth1 metric 50
```
- `metric 50` è®© `eth1` ä¼˜å…ˆå¤„ç† `10.16.10.0/24` çš„æµé‡ï¼ˆæ¯”é»˜è®¤è·¯ç”± `metric 100` æ›´ä¼˜å…ˆï¼‰ã€‚

---

#### **4. é…ç½® `ip rule` è®©å›ç¨‹æµé‡ä¸€è‡´**
**å¦‚æœ `eth1` å¤„ç†çš„ `10.16.10.0/24` è®¾å¤‡å¯èƒ½å›ç¨‹èµ° `eth0`ï¼Œå¯èƒ½å¯¼è‡´ä¸å¯¹ç§°è·¯ç”±ã€‚å¯ä»¥ä½¿ç”¨ `ip rule` è®© `10.16.10.152`ï¼ˆ`eth1`ï¼‰çš„æµé‡å¼ºåˆ¶å›ç¨‹ `eth1`ã€‚**

```bash
# åˆ›å»ºä¸€ä¸ªæ–°çš„è·¯ç”±è¡¨
echo "200 eth1_table" | sudo tee -a /etc/iproute2/rt_tables

# è®© eth1 çš„æµé‡å›ç¨‹èµ° eth1
sudo ip rule add from 10.16.10.152 table eth1_table
sudo ip route add default via 10.16.10.1 dev eth1 table eth1_table
```

è¿™æ ·ï¼š
- **ä» `eth1`ï¼ˆ10.16.10.152ï¼‰å‘é€çš„æµé‡ï¼Œä¼šå›ç¨‹èµ° `eth1`ï¼Œä¸ä¼šå½±å“ `eth0`ã€‚**
- **æ‰€æœ‰å…¶ä»–æµé‡ä»ç„¶èµ° `eth0`ï¼Œä¸ä¼šå½±å“ä¸Šç½‘ã€‚**

---

### **éªŒè¯é…ç½®**
#### **1. æ£€æŸ¥è·¯ç”±**
```bash
ip route show
```
åº”è¯¥çœ‹åˆ°ï¼š
```
default via 10.16.10.1 dev eth0 metric 100
10.16.10.0/24 dev eth1 metric 50
```

#### **2. æ£€æŸ¥ `ip rule`**
```bash
ip rule show
```
åº”è¯¥çœ‹åˆ°ï¼š
```
0:      from all lookup local
32765:  from 10.16.10.152 lookup eth1_table
32766:  from all lookup main
32767:  from all lookup default
```

#### **3. æµ‹è¯•**
- æµ‹è¯•ä¸Šç½‘æ˜¯å¦é€šè¿‡ `eth0`ï¼š
  ```bash
  curl --interface eth0 http://ifconfig.me
  ```
- æµ‹è¯• `eth1` æ˜¯å¦å¤„ç† `10.16.10.0/24` çš„æµé‡ï¼š
  ```bash
  ping -I eth1 10.16.10.100
  ```
- æµ‹è¯•å›ç¨‹æµé‡ï¼š
  ```bash
  ip route get 8.8.8.8 from 10.16.10.152
  ```
  **è¾“å‡ºåº”è¯¥æ˜¾ç¤ºæµé‡èµ° `eth1`ã€‚**

---

### **æ€»ç»“**
âœ… **é»˜è®¤æµé‡ï¼ˆä¸Šç½‘ï¼‰é€šè¿‡ `eth0`**
âœ… **å±€åŸŸç½‘æµé‡ `10.16.10.0/24` é€šè¿‡ `eth1`**
âœ… **å›ç¨‹æµé‡ä¿æŒä¸€è‡´ï¼Œé¿å…ä¸å¯¹ç§°è·¯ç”±é—®é¢˜**